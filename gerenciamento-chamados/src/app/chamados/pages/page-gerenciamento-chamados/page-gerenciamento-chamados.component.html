<app-confirm-dialog></app-confirm-dialog>

<div class="page-chamados min-h-screen flex flex-col">

  <div class="px-6 pt-4">
    <div class="flex flex-col sm:flex-row gap-3 sm:items-center mx-auto w-full">
      <p-iconField class="w-full sm:flex-1">
        <p-inputIcon class="pi pi-search" />
        <input
          pInputText
          class="w-full pr-10"
          placeholder="Buscar por título, descrição ou categoria"
          [ngModel]="searchTerm()"
          (ngModelChange)="searchTerm.set($event)"
        />
        <p-inputIcon iconPosition="right" *ngIf="searchTerm()">
          <button
            type="button"
            class="p-input-icon p-link"
            aria-label="Limpar busca"
            (click)="searchTerm.set('')"
          >
            <i class="pi pi-times"></i>
          </button>
        </p-inputIcon>
      </p-iconField>

      <p-select
        class="w-full sm:w-64"
        [options]="categoryOptions()"
        placeholder="Filtrar por categoria"
        [showClear]="true"
        appendTo="body"
        [ngModel]="selectedCategory()"
        (ngModelChange)="selectedCategory.set($event)"
      />
    </div>
  </div>

  @if (totalFiltrado() === 0) {
    <div class="px-6 pt-2">
      <p-message severity="warn">Nenhum resultado encontrado.</p-message>
    </div>
  }

  <app-button
    label="Novo chamado"
    icon="pi pi-plus"
    severity="help"
    class="botao-novo-chamado px-6 pt-3 pb-0"
    (click)="criarNovoChamado()"
  />

  <div class="px-6 py-4 grid grid-cols-1 lg:grid-cols-3 gap-4 items-start">
      <app-blocos-chamados
      title="Não atendidos"
      [badge]="chamadosNaoAtendidos().length"
      severity="danger"
      [expanded]="true"
      (chamadoDropped)="handleDrop($event, 'ATENDER')"
    >
      @for (chamado of chamadosNaoAtendidos(); track chamado.id) {
        <app-card-chamados
          [chamado]="chamado"
          (edit)="editarChamado($event)"
          (remove)="removerChamado($event)"
          (moveToStatus)="handleMoveToStatus(chamado, $event)"
        />
      }
    </app-blocos-chamados>

    <app-blocos-chamados
      title="Em andamento"
      [badge]="chamadosEmAndamento().length"
      severity="warn"
      [expanded]="true"
      (chamadoDropped)="handleDrop($event, 'ANDAMENTO')"
    >
      @for (chamado of chamadosEmAndamento(); track chamado.id) {
        <app-card-chamados
          [chamado]="chamado"
          (edit)="editarChamado($event)"
          (remove)="removerChamado($event)"
          (moveToStatus)="handleMoveToStatus(chamado, $event)"
        />
      }
    </app-blocos-chamados>

    <app-blocos-chamados
      title="Finalizados"
      [badge]="chamadosFinalizados().length"
      severity="success"
      [expanded]="true"
      (chamadoDropped)="handleDrop($event, 'FINALIZADO')"
    >
      @for (chamado of chamadosFinalizados(); track chamado.id) {
        <app-card-chamados
          [chamado]="chamado"
          (edit)="editarChamado($event)"
          (remove)="removerChamado($event)"
          (moveToStatus)="handleMoveToStatus(chamado, $event)"
        />
      }
    </app-blocos-chamados>
  </div>
</div>

